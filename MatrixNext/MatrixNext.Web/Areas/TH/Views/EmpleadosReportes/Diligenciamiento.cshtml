@{
    ViewData["Title"] = "Reporte de Diligenciamiento";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-md-12">
            <h1>@ViewData["Title"]</h1>
            <p class="text-muted">Estado de actualización de información de empleados</p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive" style="max-height: 600px; overflow-y: auto;">
                        <table class="table table-striped table-hover" id="tableDiligenciamiento">
                            <thead style="position: sticky; top: 0; background-color: #fff; z-index: 1;">
                                <tr>
                                    <th>Identificación</th>
                                    <th>Nombres y Apellidos</th>
                                    <th>ServiceLine/Área</th>
                                    <th>Correo Ipsos</th>
                                    <th class="text-center">Experiencia Laboral</th>
                                    <th class="text-center">Educación</th>
                                    <th class="text-center">Contactos Emergencia</th>
                                    <th class="text-center">Histórico Posiciones</th>
                                    <th class="text-center">Salarios</th>
                                    <th class="text-center">Datos Laborales</th>
                                    <th class="text-center">Datos Personales</th>
                                    <th class="text-center">Inglés</th>
                                    <th class="text-center">Nómina</th>
                                    <th class="text-center">% Diligenciamiento</th>
                                </tr>
                            </thead>
                            <tbody id="bodyDiligenciamiento">
                                <!-- Datos se cargarán dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div class="row d-none" id="loadingSpinner">
        <div class="col-md-12 text-center">
            <div class="spinner-border" role="status">
                <span class="sr-only">Cargando...</span>
            </div>
            <p>Cargando reporte...</p>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            cargarReporte();

            function cargarReporte() {
                $('#loadingSpinner').removeClass('d-none');
                $('#bodyDiligenciamiento').empty();

                $.ajax({
                    url: '/TH/EmpleadosReportes/Diligenciamiento/Data',
                    type: 'GET',
                    success: function(response) {
                        $('#loadingSpinner').addClass('d-none');
                        if (response.success) {
                            mostrarReporte(response.data);
                        } else {
                            alert(response.message || 'Error al cargar reporte');
                        }
                    },
                    error: function() {
                        $('#loadingSpinner').addClass('d-none');
                        alert('Error al conectar con el servidor');
                    }
                });
            }

            function mostrarReporte(datos) {
                if (!datos || datos.length === 0) {
                    $('#bodyDiligenciamiento').html('<tr><td colspan="14" class="text-center">No hay datos disponibles</td></tr>');
                    return;
                }

                datos.forEach(function(registro) {
                    const row = `
                        <tr>
                            <td>${registro.personaId}</td>
                            <td>${registro.nombres} ${registro.apellidos}</td>
                            <td>${registro.areaTxt || ''}</td>
                            <td>${registro.correoIpsos || ''}</td>
                            <td class="text-center">${getIcono(registro.experienciaLaboral)}</td>
                            <td class="text-center">${getIcono(registro.educacion)}</td>
                            <td class="text-center">${getIcono(registro.contactoEmergencia)}</td>
                            <td class="text-center">${getIcono(registro.historicoPosiciones)}</td>
                            <td class="text-center">${getIcono(registro.salarios)}</td>
                            <td class="text-center">${getIcono(registro.datosLaborales)}</td>
                            <td class="text-center">${getIcono(registro.datosPersonales)}</td>
                            <td class="text-center">${getIcono(registro.ingles)}</td>
                            <td class="text-center">${getIcono(registro.nomina)}</td>
                            <td class="text-center">
                                <span class="badge ${getBadgeClass(registro.porcentajeDiligenciamiento)}">
                                    ${registro.porcentajeDiligenciamiento}%
                                </span>
                            </td>
                        </tr>
                    `;
                    $('#bodyDiligenciamiento').append(row);
                });
            }

            function getIcono(valor) {
                if (valor) {
                    return '<i class="fas fa-check-circle text-success"></i>';
                } else {
                    return '<i class="fas fa-times-circle text-danger"></i>';
                }
            }

            function getBadgeClass(porcentaje) {
                if (porcentaje >= 80) return 'badge-success';
                if (porcentaje >= 50) return 'badge-warning';
                return 'badge-danger';
            }
        });
    </script>
}
